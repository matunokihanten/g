<!DOCTYPE html>




<a href="https://px.a8.net/svt/ejp?a8mat=35UE1S+6V2WTU+CO4+6L9O1" rel="nofollow">
<img border="0" width="728" height="90" alt="" src="https://www25.a8.net/svt/bgt?aid=191214496415&wid=001&eno=01&mid=s00000001642001107000&mc=1"></a>
<img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=35UE1S+6V2WTU+CO
4+6L9O1" alt="">


<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>é€²åŒ–ç‰ˆã‚·ãƒ³ãƒ—ãƒ«HTMLã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/monokai.min.css">
  
  <style>
    /* ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’ç¸¦ã«ä¸¦ã¹ãŸ1ç”»é¢ã¨ã™ã‚‹ */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      /* iOS ã® Safe Area ã«å¯¾å¿œ */
      padding-top: env(safe-area-inset-top);
      padding-bottom: 0; 
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      overflow: hidden; 
    }
    
    /* ------------------------------ */
    /* åºƒå‘ŠãƒãƒŠãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« (åºƒå‘Šã¯å‰Šé™¤æ¸ˆ) */
    /* ------------------------------ */
    .ad-container {
        text-align: center;
        padding: 0; 
        background-color: #fff;
        border-bottom: none; 
    }
    @media (max-width: 768px) {
        .ad-container img {
            width: 100%;
            height: auto;
        }
    }

    /* ------------------------------ */
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* ------------------------------ */
    .controls {
      padding: 10px;
      background-color: #f8f9fa;
      border-top: 1px solid #dee2e6;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      flex-wrap: wrap; 
      gap: 8px;
      position: relative;
      z-index: 20;
      box-shadow: 0 4px 6px rgba(0,0,0,0.08);
      overflow-x: hidden; 
      max-height: fit-content;
    }

    /* ãƒœã‚¿ãƒ³ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    .controls button {
      padding: 10px 15px;
      cursor: pointer;
      border: 1px solid #007bff;
      border-radius: 6px;
      background-color: #ffffff;
      color: #007bff;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-grow: 1;
      min-width: 80px;
    }
    .controls button:hover:not(:disabled) {
      background-color: #e9ecef;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }
    .controls button:active:not(:disabled) {
      transform: translateY(1px);
    }

    /* ç‰¹å®šã®ãƒœã‚¿ãƒ³ã‚’å¤§ããã€è¦‹ã‚„ã™ãã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
    .controls button.prominent {
      padding: 12px 20px;
      font-size: 1.05em;
      font-weight: bold;
      background-color: #007bff;
      color: white;
      border-color: #007bff;
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
      flex-grow: 1.5;
      min-width: 100px;
    }
    .controls button.prominent:hover:not(:disabled) {
      background-color: #0056b3;
      border-color: #0056b3;
      box-shadow: 0 6px 10px rgba(0, 123, 255, 0.5);
    }

    /* å…¨å‰Šé™¤ãƒœã‚¿ãƒ³ã¯è­¦å‘Šè‰²ã« */
    .controls button#clearAllBtn.prominent {
      background-color: #dc3545;
      border-color: #dc3545;
      box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);
    }
    .controls button#clearAllBtn.prominent:hover:not(:disabled) {
      background-color: #c82333;
      border-color: #c82333;
      box-shadow: 0 6px 10px rgba(220, 53, 69, 0.5);
    }
    
    /* ç©ºç™½è¡Œå‰Šé™¤ãƒœã‚¿ãƒ³ã®è‰² */
    .controls button#removeEmptyLinesBtn {
        background-color: #f0ad4e;
        color: white;
        border-color: #f0ad4e;
    }
    .controls button#removeEmptyLinesBtn:hover {
        background-color: #ec971f;
        border-color: #ec971f;
    }

    /* ------------------------------ */
    /* è¨­å®šã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* ------------------------------ */
    .setting-group {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px;
      background-color: #e9ecef;
      border-radius: 4px;
      flex-shrink: 0;
      flex-grow: 0;
      min-width: fit-content;
    }
    .setting-group label {
      font-size: 0.9em;
      font-weight: bold;
      color: #495057;
    }
    .setting-group button {
      padding: 6px 10px;
      font-size: 0.9em;
      min-width: 30px;
      border: 1px solid #6c757d;
      color: #343a40;
      background-color: #f8f9fa;
      box-shadow: none;
      flex-grow: 0;
      min-width: auto;
    }
    
    /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .dropdown {
        position: relative;
        display: inline-block;
        flex-grow: 1;
        min-width: 80px; /* ä»–ã®ãƒœã‚¿ãƒ³ã¨åˆã‚ã›ã‚‹ */
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 100%;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 10;
        top: 100%; /* ãƒœã‚¿ãƒ³ã®ä¸‹ã«é…ç½® */
        left: 0;
        border-radius: 6px;
        overflow: hidden;
    }
    .dropdown-content button {
        color: #007bff;
        padding: 10px 15px;
        text-decoration: none;
        display: block;
        border: none;
        width: 100%;
        text-align: left;
        background: none;
        box-shadow: none;
        min-width: 100%;
        margin: 0;
        border-radius: 0;
        flex-grow: 0;
        border-bottom: 1px solid #eee;
    }
    .dropdown-content button:last-child {
        border-bottom: none;
    }
    .dropdown-content button:hover {
        background-color: #f1f1f1;
    }
    .dropdown:hover .dropdown-content {
        display: block;
    }


    /* ------------------------------ */
    /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã®èª¿æ•´ (ãƒ‘ãƒãƒ«ã®é«˜ã•ã‚’æœ€å°åŒ–) */
    /* ------------------------------ */
    @media (max-width: 768px) {
        .controls {
            gap: 4px; 
            padding: 8px;
        }
        .controls button {
            flex-shrink: 1;
            min-width: 60px;
            padding: 8px 10px;
        }
        .controls button.prominent {
            min-width: 80px;
            padding: 10px 15px;
        }
        /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚‚æŸ”è»Ÿã« */
        .dropdown {
             flex-grow: 1;
             min-width: 60px;
        }
        .dropdown-content {
             top: calc(100% + 4px); /* ãƒœã‚¿ãƒ³ã¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®é–“ã«å°‘ã—éš™é–“ */
        }
        
        /* è¨­å®šã‚°ãƒ«ãƒ¼ãƒ—ã¯ç”»é¢å¹…ã„ã£ã±ã„ã«è¡¨ç¤ºã—ã€å¿…ãš2è¡Œç›®/3è¡Œç›®ä»¥é™ã«é…ç½® */
        .controls .setting-group {
            flex-basis: 100%; 
            justify-content: space-around;
            order: 10;
        }
    }


    /* ------------------------------ */
    /* ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼é ˜åŸŸã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* ------------------------------ */
    .editor {
      /* flex: 1; ã«ã‚ˆã‚Šã€æ“ä½œãƒ‘ãƒãƒ«ã‚’é™¤ã„ãŸæ®‹ã‚Šã®ç”»é¢ã®é«˜ã•ã‚’å…¨ã¦å æœ‰ */
      flex: 1; 
      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å•é¡Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã€ã“ã®ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’é©ç”¨ */
      padding-bottom: env(safe-area-inset-bottom);
      overflow: hidden; 
      display: flex;
    }
    .CodeMirror {
      height: 100% !important; 
      width: 100%;
      border: none; 
      font-size: 14px;
      transition: font-size 0.2s ease;
    }
    .CodeMirror-gutters {
        background-color: #f7f7f7;
        border-right: 1px solid #ddd;
    }
    .cm-s-monokai .CodeMirror-gutters {
        background-color: #3e3e3e;
        border-right: 1px solid #555;
    }

    /* ------------------------------ */
    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* ------------------------------ */
    #messageArea {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%) translateX(20px);
      padding: 10px 18px;
      font-size: 0.9em;
      white-space: nowrap;
      background-color: rgba(0, 0, 0, 0.85);
      color: white;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.4s ease-out, transform 0.4s ease-out, background-color 0.4s ease;
      z-index: 100;
      pointer-events: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    #messageArea.show {
        opacity: 1;
        transform: translateY(-50%) translateX(0);
    }
    #messageArea.success { background-color: #28a745; }
    #messageArea.error { background-color: #dc3545; }
    #messageArea.info { background-color: #17a2b8; }
    
    /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®èª¿æ•´ */
    @media (max-width: 768px) {
        #messageArea {
            top: 10px;
            transform: translateY(0) translateX(20px);
        }
        #messageArea.show {
            transform: translateY(0) translateX(0);
        }
        #messageArea:not(.show) {
            transform: translateY(0) translateX(20px);
        }
    }
  </style>
</head>
<body>

  <div class="ad-container"></div>

  <div class="controls" id="controlsPanel"> 
    <div id="messageArea"></div>

    <button id="pasteBtn" class="prominent">è²¼ä»˜ã‘</button>
    <button id="clearAllBtn" class="prominent">å…¨å‰Šé™¤</button>
    <button id="runBtn" class="prominent">å®Ÿè¡Œ</button>
    
    <button id="selectAllBtn">å…¨é¸æŠ</button>
    <button id="copyBtn">ã‚³ãƒ”ãƒ¼</button>
    <button id="openFileBtn">é–‹ã</button>
    <button id="removeEmptyLinesBtn">ç©ºç™½è¡Œå‰Šé™¤</button>

    <div class="dropdown">
        <button id="saveDropdownBtn">ä¿å­˜ â–¼</button>
        <div class="dropdown-content">
            <button id="saveHtmlBtn">HTMLã¨ã—ã¦ä¿å­˜</button>
            <button id="saveTxtBtn">TXTã¨ã—ã¦ä¿å­˜</button>
        </div>
    </div>
    
    <input type="file" id="fileInput" accept=".html,.txt" style="display:none">

    <div class="setting-group">
        <label for="themeToggleBtn">ãƒ†ãƒ¼ãƒ:</label>
        <button id="themeToggleBtn">ğŸ¨ Light/Dark</button>
    </div>
  </div>

  <div class="editor">
    <textarea id="htmlCode" placeholder="ã“ã“ã«HTMLã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  
  <script>
    // ------------------------------
    // CodeMirrorã®åˆæœŸåŒ–
    // ------------------------------
    var cm = CodeMirror.fromTextArea(document.getElementById('htmlCode'), {
      mode: "htmlmixed",
      lineNumbers: true,
      theme: localStorage.getItem("editorTheme") || "default",
      lineWrapping: true,
      indentUnit: 2,
      tabSize: 2,
      extraKeys: {
          "Tab": function(cm) {
              if (cm.somethingSelected()) {
                  cm.indentSelection("add");
              } else {
                  cm.replaceSelection(Array(cm.getOption("indentUnit") + 1).join(" "), "end");
              }
          }
      }
    });

    // ------------------------------
    // UX/UI å¼·åŒ–æ©Ÿèƒ½ (åˆæœŸè¨­å®šã®ãƒ­ãƒ¼ãƒ‰ã¨ä¿å­˜)
    // ------------------------------
    const DEFAULT_FONT_SIZE = 14;
    document.querySelector('.CodeMirror').style.fontSize = `${DEFAULT_FONT_SIZE}px`;

    // localStorage ã«ä¿å­˜ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°å¾©å…ƒ
    const savedCode = localStorage.getItem("htmlCode");
    if (savedCode) {
      cm.setValue(savedCode);
    } else {
        // åˆå›èµ·å‹•æ™‚ã‚„ã‚¯ãƒªã‚¢å¾Œã®åˆæœŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
        cm.setValue("<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>æ–°ã—ã„ãƒšãƒ¼ã‚¸</title>\n</head>\n<body>\n  <h1>Hello, World!</h1>\n</body>\n</html>");
    }

    // ç·¨é›†å†…å®¹ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã« localStorage ã¸ä¿å­˜
    cm.on("change", function() {
      localStorage.setItem("htmlCode", cm.getValue());
    });
    
    // ------------------------------
    // è¦ç´ ã®å–å¾—ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢æ•°
    // ------------------------------
    const selectAllBtn = document.getElementById('selectAllBtn');
    const copyBtn = document.getElementById('copyBtn');
    const pasteBtn = document.getElementById('pasteBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const openFileBtn = document.getElementById('openFileBtn');
    const fileInput = document.getElementById('fileInput');
    const runBtn = document.getElementById('runBtn');
    const removeEmptyLinesBtn = document.getElementById('removeEmptyLinesBtn'); 
    const messageArea = document.getElementById('messageArea');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const saveHtmlBtn = document.getElementById('saveHtmlBtn'); // ã€æ–°è¦ã€‘HTMLä¿å­˜ãƒœã‚¿ãƒ³
    const saveTxtBtn = document.getElementById('saveTxtBtn');   // ã€æ–°è¦ã€‘TXTä¿å­˜ãƒœã‚¿ãƒ³


    /**
     * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé–¢æ•°
     * @param {string} msg - è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
     * @param {'success'|'error'|'info'} type - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 'info')
     */
    function showMessage(msg, type = 'info') {
      messageArea.textContent = msg;
      messageArea.className = 'show ' + type;

      const activeElement = document.activeElement;
      if (activeElement && activeElement.tagName === 'BUTTON') {
          activeElement.style.transform = 'scale(0.95)';
          activeElement.style.opacity = '0.8';
          setTimeout(() => {
              activeElement.style.transform = '';
              activeElement.style.opacity = '';
          }, 400);
      }

      setTimeout(() => {
        messageArea.className = '';
        messageArea.textContent = '';
      }, 2500);
    }
    
    /**
     * CodeMirrorã®ã‚µã‚¤ã‚ºã‚’æ›´æ–°ã—ã€è¡¨ç¤ºå´©ã‚Œã‚’ä¿®æ­£ã™ã‚‹é–¢æ•°
     */
    function refreshEditor() {
        cm.refresh(); 
    }

    /**
     * ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®å…±é€šå‡¦ç†
     * @param {string} filename - ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å (ä¾‹: index.html, memo.txt)
     * @param {string} mimeType - MIMEã‚¿ã‚¤ãƒ— (ä¾‹: text/html, text/plain)
     */
    function saveFile(filename, mimeType) {
        var content = cm.getValue();
        if (!content.trim()) {
            showMessage("ã‚³ãƒ¼ãƒ‰ãŒç©ºãªã®ã§ä¿å­˜ã‚’ä¸­æ­¢ã—ã¾ã—ãŸ", "error");
            return;
        }
        var blob = new Blob([content], { type: mimeType });
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.style.display = "none";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showMessage(`${filename}ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ`, "success");
    }


    // ------------------------------
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: æ—¢å­˜æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ç¶­æŒ
    // ------------------------------
    
    // å…¨é¸æŠãƒœã‚¿ãƒ³
    selectAllBtn.addEventListener('click', function() {
      cm.focus();
      cm.execCommand("selectAll");
      showMessage("å…¨é¸æŠã—ã¾ã—ãŸ", "info");
    });

    // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
    copyBtn.addEventListener('click', function() {
      if (!cm.somethingSelected()) {
        cm.focus();
        cm.execCommand("selectAll");
      }
      var text = cm.getSelection();
      navigator.clipboard.writeText(text)
        .then(() => showMessage("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success"))
        .catch(err => showMessage("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„", "error"));
    });

    // è²¼ä»˜ã‘ãƒœã‚¿ãƒ³
    pasteBtn.addEventListener('click', function() {
      navigator.clipboard.readText()
        .then(text => {
          cm.replaceSelection(text);
          setTimeout(refreshEditor, 0); 
          showMessage("è²¼ã‚Šä»˜ã‘ã¾ã—ãŸ", "success");
          cm.focus();
        })
        .catch(err => showMessage("è²¼ã‚Šä»˜ã‘ã«å¤±æ•—ã—ã¾ã—ãŸ: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã®èª­ã¿å–ã‚Šã‚’è¨±å¯ã—ã¦ãã ã•ã„", "error"));
    });

    // å…¨å‰Šé™¤ãƒœã‚¿ãƒ³
    clearAllBtn.addEventListener('click', function() {
      if (confirm("æœ¬å½“ã«å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰")) {
        cm.setValue("");
        showMessage("å…¨ã¦å‰Šé™¤ã—ã¾ã—ãŸ", "info");
        cm.focus();
        setTimeout(refreshEditor, 0); 
      }
    });
    
    // ç©ºç™½è¡Œå‰Šé™¤ãƒœã‚¿ãƒ³
    removeEmptyLinesBtn.addEventListener('click', function() {
        const originalValue = cm.getValue();
        const newValue = originalValue.split('\n').filter(line => line.trim() !== '').join('\n');
        
        if (originalValue === newValue) {
             showMessage("å‰Šé™¤ã§ãã‚‹ç©ºç™½è¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ", "info");
             return;
        }

        cm.setValue(newValue);
        showMessage("ç©ºç™½è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸ", "success");
        cm.focus();
        setTimeout(refreshEditor, 0); 
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ããƒœã‚¿ãƒ³
    openFileBtn.addEventListener('click', function() {
      fileInput.click();
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸã‚‰ FileReader ã§å†…å®¹ã‚’èª­ã¿è¾¼ã¿ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«è¨­å®š
    fileInput.addEventListener('change', function(e) {
      var file = e.target.files[0];
      if (file) {
        var reader = new FileReader();
        reader.onload = function(evt) {
          cm.setValue(evt.target.result);
          setTimeout(refreshEditor, 100); 
          showMessage(`ãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${file.name}ã€ã‚’é–‹ãã¾ã—ãŸ`, "success");
          cm.focus();
        }
        reader.readAsText(file);
      }
      fileInput.value = '';
    });

    // ã€ä¿®æ­£ãƒ»æ‹¡å¼µã€‘HTMLã¨ã—ã¦ä¿å­˜
    saveHtmlBtn.addEventListener('click', function() {
        saveFile("index.html", "text/html");
    });
    
    // ã€æ–°è¦æ©Ÿèƒ½ã€‘TXTã¨ã—ã¦ä¿å­˜
    saveTxtBtn.addEventListener('click', function() {
        saveFile("index.txt", "text/plain");
    });
    
    // å®Ÿè¡Œãƒœã‚¿ãƒ³
    runBtn.addEventListener('click', function() {
      var content = cm.getValue();
      if (!content.trim()) {
          showMessage("ã‚³ãƒ¼ãƒ‰ãŒç©ºãªã®ã§å®Ÿè¡Œã‚’ä¸­æ­¢ã—ã¾ã—ãŸ", "error");
          return;
      }
      var blob = new Blob([content], { type: "text/html" });
      var url = URL.createObjectURL(blob);
      window.open(url, "_blank");
      showMessage("ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ (æ–°è¦ã‚¿ãƒ–)", "info");
    });

    
    // ------------------------------
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: UI/UXæ©Ÿèƒ½
    // ------------------------------

    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    themeToggleBtn.addEventListener('click', function() {
        const currentTheme = cm.getOption("theme");
        const newTheme = currentTheme === "monokai" ? "default" : "monokai";
        cm.setOption("theme", newTheme);
        localStorage.setItem("editorTheme", newTheme);
        showMessage(`${newTheme === "monokai" ? "ãƒ€ãƒ¼ã‚¯" : "ãƒ©ã‚¤ãƒˆ"}ãƒ†ãƒ¼ãƒã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`, "info");
    });
    
    // Emmeté¢¨ã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè£œå®Œæ©Ÿèƒ½
    cm.on("inputRead", function(cm, change) {
        if (change.text[0] === '!' && change.text.length === 1 && change.from.line === cm.firstLine() && cm.getLine(change.from.line).trim() === '!') {
            const template = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–°ã—ã„ãƒšãƒ¼ã‚¸</title>
</head>
<body>

</body>
</html>`;
            cm.replaceRange(template, {line: change.from.line, ch: 0}, change.to);
            const cursorLine = 4;
            const cursorCh = 10;
            cm.setCursor(cursorLine, cursorCh);
            setTimeout(refreshEditor, 0); 
            showMessage("HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ¿å…¥ã—ã¾ã—ãŸ", "success");
        }
    });

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œ (ç”»é¢ã®å›è»¢ã‚„ãƒªã‚µã‚¤ã‚ºã«å¯¾å¿œ)
    window.addEventListener('resize', function() {
        refreshEditor();
    });

    // èµ·å‹•æ™‚ã«ä¸€åº¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œã—ã€åˆæœŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œã‚’é˜²ã
    window.onload = function() {
        refreshEditor();
        setTimeout(refreshEditor, 200);
    };

  </script>
</body>
</html>
